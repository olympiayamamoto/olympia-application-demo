<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>店舗申請ポータル（デモ）</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body{font-family:Meiryo,Arial,sans-serif;background:#f5f6f7;margin:0}
.hidden{display:none}
.container{max-width:420px;margin:auto;background:#fff;min-height:100vh}
header{background:#f2a7c6;color:#fff;padding:14px;text-align:center;font-weight:bold}
section{padding:16px}
input,select,button,textarea{width:100%;padding:10px;margin:6px 0;font-size:14px}
button{background:#f2a7c6;color:#fff;border:none;border-radius:6px}
.menu button{margin-bottom:10px}
.card{border:1px solid #ddd;border-radius:8px;padding:10px;margin-bottom:8px}
.small{font-size:12px;color:#666}
</style>
</head>
<body>
<div class="container">
<header>店舗申請ポータル（デモ）</header>

<!-- ログイン -->
<section id="login">
  <h3>ログイン</h3>
  <input id="loginId" placeholder="店舗ID" />
  <input id="loginPw" type="password" placeholder="パスワード" />
  <button onclick="login()">ログイン</button>
</section>

<!-- ホーム -->
<section id="home" class="hidden">
  <h3>ホーム</h3>
  <div class="menu">
    <button onclick="show('new')">新規申請</button>
    <button onclick="show('history')">過去の履歴</button>
    <button onclick="show('status')">進捗状況</button>
    <button id="adminBtn" class="hidden" onclick="show('admin')">管理画面</button>
    <button onclick="logout()">ログアウト</button>
  </div>
</section>

<!-- 新規申請 -->
<section id="new" class="hidden">
  <h3>新規申請</h3>
  <button onclick="openForm('priceDown')">値下申請書</button>
  <button onclick="show('home')">戻る</button>
</section>

<!-- 値下申請フォーム -->
<section id="priceDown" class="hidden">
  <h3>値下申請書</h3>
  <div id="formArea"></div>
  <button onclick="submitForm()">申請</button>
  <button onclick="show('home')">キャンセル</button>
</section>

<!-- 履歴 -->
<section id="history" class="hidden">
  <h3>過去の履歴</h3>
  <div id="historyList"></div>
  <button onclick="exportCSV()">CSV出力</button>
  <button onclick="show('home')">戻る</button>
</section>

<!-- 進捗 -->
<section id="status" class="hidden">
  <h3>進捗状況</h3>
  <div id="statusList"></div>
  <button onclick="show('home')">戻る</button>
</section>

<!-- 管理画面 -->
<section id="admin" class="hidden">
  <h3>管理画面</h3>
  <div class="card">
    <b>確認書類</b><br><span class="small">（デモ：一覧表示のみ）</span>
  </div>
  <div class="card">
    <b>ユーザー管理</b><br><span class="small">（店舗ID・管理者区分）</span>
  </div>
  <div class="card">
    <b>書類設定</b><br><span class="small">（フォーム定義・WF設定）</span>
  </div>
  <button onclick="show('home')">戻る</button>
</section>

</div>

<script>
// ===== 設定（ここを編集すれば書類を増やせます） =====
const formConfig = {
  priceDown: [
    {key:'store', label:'店舗名', type:'text'},
    {key:'product', label:'商品名', type:'text'},
    {key:'reason', label:'値下理由', type:'textarea'},
    {key:'before', label:'値下前価格', type:'number'},
    {key:'after', label:'値下後価格', type:'number'}
  ]
};

// 仮ユーザー
const users = {
  'store01':{pw:'pass', admin:false},
  'admin01':{pw:'admin', admin:true}
};

let currentUser = null;
let currentForm = null;

function show(id){
  document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  if(id==='history') renderHistory();
  if(id==='status') renderStatus();
}

function login(){
  const id=loginId.value,pw=loginPw.value;
  if(users[id] && users[id].pw===pw){
    currentUser=id;
    show('home');
    if(users[id].admin) adminBtn.classList.remove('hidden');
  } else alert('ログイン失敗');
}
function logout(){location.reload()}

function openForm(name){
  currentForm=name;
  const area=document.getElementById('formArea');
  area.innerHTML='';
  formConfig[name].forEach(f=>{
    const el=document.createElement(f.type==='textarea'?'textarea':'input');
    el.id=f.key; if(f.type!=='textarea') el.type=f.type;
    el.placeholder=f.label;
    area.appendChild(el);
  });
  show(name);
}

function submitForm(){
  const data={user:currentUser,form:currentForm,status:'申請中',time:new Date().toISOString()};
  formConfig[currentForm].forEach(f=>data[f.key]=document.getElementById(f.key).value);
  const list=JSON.parse(localStorage.getItem('apps')||'[]');
  list.push(data); localStorage.setItem('apps',JSON.stringify(list));
  alert('申請しました'); show('home');
}

function renderHistory(){
  const list=JSON.parse(localStorage.getItem('apps')||'[]');
  historyList.innerHTML='';
  list.filter(a=>a.user===currentUser).forEach(a=>{
    const d=document.createElement('div');d.className='card';
    d.innerText=a.form+' / '+a.time; historyList.appendChild(d);
  });
}

function renderStatus(){
  const list=JSON.parse(localStorage.getItem('apps')||'[]');
  statusList.innerHTML='';
  list.forEach(a=>{
    const d=document.createElement('div');d.className='card';
    d.innerText=a.user+' / '+a.form+' / '+a.status; statusList.appendChild(d);
  });
}

function exportCSV(){
  const list=JSON.parse(localStorage.getItem('apps')||'[]');
  if(!list.length) return;
  const keys=Object.keys(list[0]);
  const rows=[keys.join(',')].concat(list.map(r=>keys.map(k=>r[k]).join(',')));
  const blob=new Blob([rows.join('\n')],{type:'text/csv'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download='applications.csv';a.click();
}
</script>
</body>
</html>
